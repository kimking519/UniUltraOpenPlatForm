<!DOCTYPE html>
<html lang="zh">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UniUltra 开放平台</title>
    <link rel="stylesheet" href="{{ url_for('static', path='/style.css') }}">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap">
</head>

<body>
    <div class="sidebar">
        <div class="sidebar-header">UniUltra</div>
        <nav class="sidebar-menu">
            <a href="/" class="menu-item {% if active_page == 'dashboard' %}active{% endif %}">总控制台</a>
            <a href="/daily" class="menu-item {% if active_page == 'daily' %}active{% endif %}">1. 动态参数</a>
            <a href="/emp" class="menu-item {% if active_page == 'emp' %}active{% endif %}">2. 员工管理</a>
            <a href="/cli" class="menu-item {% if active_page == 'cli' %}active{% endif %}">3. 客户表</a>
            <a href="/quote" class="menu-item {% if active_page == 'quote' %}active{% endif %}">4. 需求管理</a>
            <a href="/vendor" class="menu-item {% if active_page == 'vendor' %}active{% endif %}">5. 供应商表</a>
            <a href="/offer" class="menu-item {% if active_page == 'offer' %}active{% endif %}">6. 报价订单</a>
            <a href="/order" class="menu-item {% if active_page == 'order' %}active{% endif %}">7. 销售订单</a>
            <a href="/buy" class="menu-item {% if active_page == 'buy' %}active{% endif %}">8. 采购管理</a>
        </nav>
    </div>

    <div class="main-content">
        <header class="navbar">
            <div class="user-info">
                <span>管理员 (Admin)</span>
                <a href="/login" style="margin-left: 1rem; color: var(--secondary); text-decoration: none;">退出</a>
            </div>
        </header>
        <main class="container fade-in">
            {% block content %}{% endblock %}
        </main>
    </div>

    <script>
        window.addEventListener('DOMContentLoaded', () => {
            const params = new URLSearchParams(window.location.search);
            let alertMsg = [];

            if (params.has('import_success')) {
                const count = parseInt(params.get('import_success'), 10);
                if (count > 0) alertMsg.push(`批量导入成功: ${count} 条`);
            }
            if (params.has('errors')) {
                const count = parseInt(params.get('errors'), 10);
                if (count > 0) alertMsg.push(`导入失败: ${count} 条`);
            }
            if (params.has('msg')) {
                const prefix = params.get('success') === '1' ? '操作成功: ' : '操作失败: ';
                alertMsg.push(prefix + params.get('msg'));
            }

            if (alertMsg.length > 0) {
                alert(alertMsg.join('\n'));
                // Clean the URL of these parameters so a refresh doesn't trigger the alert again
                const newUrl = window.location.pathname +
                    window.location.search.replace(/[?&](import_success|errors|msg|success)=[^&]+/g, '')
                        .replace(/^&/, '?').replace(/\?$/, '');
                window.history.replaceState({}, document.title, newUrl || window.location.pathname);
            }
        });
    </script>
</body>

</html>